# 创新俄罗斯方块游戏

基于Phaser.js的创新俄罗斯方块游戏，具有独特的三方向下落物理系统。

## 特色功能

- ✨ **像素级物理模拟**：每个小颗粒独立受重力影响
- ✨ **三方向下落系统**：自然形成三角形堆积效果
- ✨ **自由拖放**：无传统俄罗斯方块的下落限制
- ✨ **连锁反应**：消除后可能触发连续的连锁消除

## 技术栈

- **游戏引擎**: Phaser.js 3.x
- **开发语言**: TypeScript
- **构建工具**: Vite
- **后端SDK**: sce-game-sdk（排行榜和数据同步）

## 快速开始

### 安装依赖

```bash
npm install
```

### 开发模式

```bash
npm run dev
```

浏览器将自动打开 http://localhost:3000

### 构建生产版本

```bash
npm run build
```

### 预览生产版本

```bash
npm run preview
```

## 项目结构

```
project-h/
├── src/
│   ├── core/              # 核心系统
│   │   ├── Grid.ts        # 双层网格系统（逻辑12×22 + 像素120×220）
│   │   ├── PhysicsManager.ts  # 三方向下落物理引擎
│   │   ├── Tetromino.ts   # 方块定义和7-Bag系统
│   │   └── GameState.ts   # 游戏状态机
│   ├── gameplay/          # 玩法逻辑
│   │   ├── DragDrop.ts    # 拖放机制
│   │   ├── Elimination.ts # 消除系统（BFS算法）
│   │   ├── Scoring.ts     # 计分系统
│   │   └── PreviewSlots.ts # 预览槽位
│   ├── rendering/         # 渲染层
│   │   ├── PixelRenderer.ts # 像素块渲染
│   │   └── Animations.ts   # 消除动画
│   ├── scenes/            # Phaser场景
│   │   ├── GameScene.ts   # 主游戏场景
│   │   └── UIScene.ts     # UI场景
│   ├── types/             # TypeScript类型定义
│   ├── config/            # 配置常量
│   └── main.ts            # 入口文件
├── docs/                  # 设计文档
└── assets/                # 资源文件
```

## 核心概念

### 双层网格系统

- **逻辑层** (12×22)：用于方块形状定义、消除判定、计分计算
- **物理层** (120×220)：用于渲染、动画、物理模拟（重力、碰撞）
- **比例**：1个逻辑格子 = 10×10个像素块

### 三方向下落物理

每个像素块独立下落，优先正下方，如果被占用则尝试斜向（左下/右下）滑落，形成自然的三角形堆积。

```typescript
// 核心算法伪代码
if (正下方为空) {
  移动到正下方;
} else if (左下方为空 || 右下方为空) {
  随机选择一个空的斜下方移动;
} else {
  标记为稳定;
}
```

## 开发进度

### Week 1: 项目基础架构与网格系统 ✅
- [x] 项目初始化（Vite + TypeScript + Phaser.js）
- [x] 双层网格系统实现（逻辑12×22 + 像素120×220）
- [x] 基础渲染系统（像素块渲染、网格线显示）

### Week 2-3: 核心玩法系统 ✅
- [x] 三方向下落物理引擎（完整实现）
- [x] 方块生成系统（7种形状 + 7-Bag随机）
- [x] 预览槽位系统（3个槽位 + 立即补充）
- [x] 拖放交互系统（拖动、碰撞检测、视觉反馈）

### Week 4: 消除机制与计分系统 ✅
- [x] 消除判定算法（BFS连通搜索）
- [x] 边界触及判定（横向连接）
- [x] 计分系统（基础公式 + 连锁加成）
- [ ] 消除动画（粒子效果）

### Week 5: 游戏流程与状态机 ✅
- [x] 游戏状态机（8种状态完整实现）
- [x] 完整游戏循环（物理→消除→重力）
- [x] 游戏结束判定
- [x] 连锁反应系统

### Week 6: UI优化与SDK集成 🚧
- [x] 基础UI（分数、状态、槽位预览）
- [x] 拖放视觉反馈
- [x] 游戏结束界面
- [ ] 消除动画特效
- [ ] sce-game-sdk集成
- [ ] 性能优化（对象池、分层渲染）
- [ ] 音效系统

## 测试说明

当前版本已实现完整的核心玩法：

1. **启动游戏**：运行 `npm run dev`，浏览器会自动打开游戏
2. **选择方块**：点击底部3个预览槽位中的任意一个
3. **拖动放置**：拖动方块到游戏区域任意位置
   - 绿色边框 = 可以放置
   - 红色边框 = 无法放置（越界或重叠）
4. **观察效果**：
   - 像素块独立下落，形成三角形堆积
   - 当同色方块横跨左右边界时触发消除
   - 连锁反应会获得额外分数倍数
5. **游戏结束**：当所有3个槽位的方块都无法放置时游戏结束

### 已实现的核心功能

- ✅ 三方向下落物理系统（山形堆积效果）
- ✅ 拖放操作（完整交互）
- ✅ 横向连接消除（BFS算法）
- ✅ 连锁反应系统
- ✅ 计分系统（含连锁加成）
- ✅ 游戏结束判定
- ✅ 预览槽位（3个，立即补充）

## 参考文档

详细设计文档请参考 [docs/GameDesignDocument.md](docs/GameDesignDocument.md)

## 许可证

MIT License

